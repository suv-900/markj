<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .container {
            display: flex;
            justify-content: space-around;
        }
        .table {
            border: 1px solid #000;
            padding: 10px;
            margin: 10px;
        }
        .table h2 {
            text-align: center;
        }
        .table ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .table li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="table">
            <h2>Friends</h2>
            <ul>
                <li>Friend 1</li>
                <li>Friend 2</li>
                <li>Friend 3</li>
                <li>Friend 4</li>
                <li>Friend 5</li>
            </ul>
        </div>
        <div class="table">
            <h2>Friend Requests</h2>
            <ul>
                <li>Request 1</li>
                <li>Request 2</li>
                <li>Request 3</li>
                <li>Request 4</li>
                <li>Request 5</li>
            </ul>
        </div>
    </div>
    
    <div>
        <a >accept</a>
        <a >deny</a>
    </div>

        <form id="addUserForm">
            <input type="text" placeholder="add user" required/><br>
            <button type="button" onclick="sendFriendRequest()" >send</button>
        </form>
        <div id="outputDiv" ></div>
    </body>
    <script>
        //show friends and pending friend requests;
        //check for token validate token
        //get friends list
        //send friend requests 
        
        const token=localStorage.getItem("Token");
        const outputDiv=document.getElementById("outputDiv");
        
        if(token === null){
            outputDiv.innerHTML="Login required";
            const anchorElement=document.createElement("a");
            anchorElement.href="localhost:8080/users/login";
            anchorElement.text="login";
            outputDiv.appendChild(anchorElement);
        }
        
        function isEmpty(s){
            return s.length === 0 ? true:false;
        }
        async function checkToken(){
            if(token === null) return;
             
            const xhttp=new XMLHttpRequest();

            xhttp.onreadystatechange=()=>{
                if(xhttp.readyState === 4){
                    const status=xhttp.status;
                    if(status === 200){
                        return;
                    } 
                    if(status === 500){
                        outputDiv.innerHTML="Server Error 500";
                    }
                    if(status === 401){
                        const anchorElement=document.createElement("a");
                        anchorElement.href="localhost:8080/users/login";
                        anchorElement.text="login";
                        outputDiv.appendChild(anchorElement);
                        outputDiv.innerHTML="Login Required";
                    }else{
                        console.log("Unknown status "+status);
                    }
                }

            }
            xhttp.open("POST","http://localhost:8080/users/verifytoken",true);
            xhttp.setRequestHeader("Token",token);
            xhttp.send();
        }
        checkToken(); 
        
        let friendsList=[]
        const friendRequestsList=[]

        async function fetchFriendsList(){
            const xhttp=new XMLHttpRequest();

            xhttp.onreadystatechange=()=>{
                if(xhttp.readyState === 4){
                    const status=xhttp.status;
                    if(status === 200){

                        friendsList=JSON.parse(xhttp.response);
                        for(let i=0;i<friendsList.length;i++){
                            const friend=document.createElement("")
                        } 
                        return;
                    } 
                    if(status === 500){
                        outputDiv.innerHTML="Server Error 500";
                    }
                    if(status === 401){
                        const anchorElement=document.createElement("a");
                        anchorElement.href="localhost:8080/users/login";
                        anchorElement.text="login";
                        outputDiv.appendChild(anchorElement);
                        outputDiv.innerHTML="Login Required";
                    }else{
                        console.log("Unknown status "+status);
                    }

                }
            }
            xhttp.open("GET","http://localhost:8080/users/getFriends",true);
            xhttp.setRequestHeader("Token",token);
            xhttp.send();
        } 
        fetchFriendsList();

        async function fetchPendingFriendRequests(){
            const xhttp=new XMLHttpRequest();

            xhttp.onreadystatechange=()=>{
                if(xhttp.readyState === 4){

                }
            }

            xhttp.open("GET","http://localhost:8080/users/getPendingFriendRequests",true);
            xhttp.setRequestHeader("Token",token);
            xhttp.send();
        }
        

        async function sendFriendRequest(){
            const toUsername=document.getElementById("addUserForm").elements[0];
            if( isEmpty(toUsername)){
                outputDiv.innerHTML="empty fields";
                return;
            }

            const xhttp=new XMLHttpRequest();

            xhttp.onreadystatechange=()=>{
                if(xhttp.readyState === 4){
                    const status=xhttp.status;
                    if(status === 200){
                        requestStatusDiv.innerHTML="Request sent";
                    }
                    if(status === 500){
                        requestStatusDiv.innerHTML="Server Error";
                    }else{
                        console.log("Unknown status: "+status);
                    }
                }
            }

            xhttp.open("POST","localhost:8080/users/sendFriendRequest",true);
            xhttp.setRequestHeader("Token",token);
            xhttp.send(toUsername);
        }

        

    </script>
</html>